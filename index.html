<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>
        Trivia Game
    </title>
    <link rel="stylesheet" type="text/css" href="./assets/css/reset.css">
    <!-- Bootstrap link -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="./assets/css/style.css">
    <style type="text/css">
    body {
        background-color: grey;
        /* background-image: url(./assets/images/background.jpg); */
    }

    #questionBlock {
        display: block;
        background-color: white;
        margin-top: 100px;
        margin-left: 400px;
        height: 600px;
        width: 1100px;
    }

    h1 {
        text-align: center;
        margin-top: 30px;
        text-shadow: 15px;
        color: white;
    }

    #question {
        margin: 10px;
    }

    .ansbuttons {

        text-align: center;
        border-width: 1px;
        height: 60px;
        width: 600px;
        padding-bottom: 50px;
        font-size: 40px;
    }

    .ansbuttons:hover {
        background-color: orange;
        border-style: solid;
    }

    .ansbuttons:active {
        background-color: grey;
    }

    .timeLeft {
        font-size: 50px;
    }

    #timerem {
        color: green;
    }

    #startButton {
        background-color: orange;
        border-style: solid;
    }
    </style>
</head>

<body>
    <h1>Totally Trivial Trivia Game !!</h1>
    <div id="questionBlock">
        <div class="timeLeft">
            <p class="timeLeft"> <span class="timeLeft" id=timerem> </span> </p>
        </div>
        <div id="question">
        </div>
        <div id="answerSection">
            <div class="ansbuttons" id="startButton" style="position:relative;top:300px;left:200px;">
                <p> Start </p>
            </div>
            <!-- should have other divs in there with  -->
        </div>
    </div>
    <!-- Jquery link -->
    <script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
    <!-- <script type="text/javascript" src="./assets/javascript/game.js"></script> -->
    <script type="text/javascript">
    var correctAnswerPosition = 0;
    var correctAnswer;
    var time = 30;
    var isNewQuestion = false;
    var correctlyAnswered = 0;
    var unAnswered = 0;
    var wronglyAnswered = 0;
    var questionCount = 0;
    var intervalId=0;

    queryURL = "https://opentdb.com/api.php?amount=1&category=11&difficulty=easy&type=multiple"

    

    function loadNewQuestion() {

        $('#timerem').text("Time Remaining ");

        correctAnswerPosition = 0;
        correctAnswer;
        time = 30;

        if (isNewQuestion) {
            // clearInterval(internew);
            // internew = false;
            clearInterval(intervalId);
            clearbox();   
            console.log("New question " + questionCount)
        }

        if (questionCount < 5) //total number of questions
        {
            clearbox(); 

            $.ajax({
                url: queryURL,
                method: "GET"
            }).done(function(res) {
                response = res;
                console.log(response);
                document.getElementById('question').innerHTML = "<h3>" + response.results[0].question + "</h3>";

                /*get random position to place the correct answer*/

                correctAnswerPosition = Math.floor((Math.random() * 4))
                console.log("Correct answer: " + response.results[0].correct_answer + " in Position : " + correctAnswerPosition);
                correctAnswer = response.results[0].correct_answer;
                //create an array 
                var answers = [response.results[0].incorrect_answers[0], response.results[0].incorrect_answers[1], response.results[0].incorrect_answers[2]]
                //add the correct answer into the random position
                answers.splice(correctAnswerPosition, 0, response.results[0].correct_answer);

                document.getElementById('answerSection').innerHTML = document.getElementById('answerSection').innerHTML + "<div class='ansbuttons id='button1'> <p>" + answers[0] + " </p> </div> ";
                document.getElementById('answerSection').innerHTML = document.getElementById('answerSection').innerHTML + "<div class='ansbuttons'> <p>" + answers[1] + "</p>";
                document.getElementById('answerSection').innerHTML = document.getElementById('answerSection').innerHTML + "<div class='ansbuttons'> <p>" + answers[2] + "</p>";
                document.getElementById('answerSection').innerHTML = document.getElementById('answerSection').innerHTML + "<div class='ansbuttons'> <p>" + answers[3] + "</p>";

                questionCount++;
                
                clearInterval(intervalId);
                intervalId = setInterval(incrTime, 1000);
                console.log('first'+intervalId);
            });

        } 
        else 
        {
            //Summary Page
            clearInterval(intervalId);
            clearbox();
            $('#question').html("<h2> Summary </h2>");
            $('#answerSection').html("<p> Correct Answers: " + correctlyAnswered + "</p>");
            $('#answerSection').append("<p> Wrongly Answers: " + wronglyAnswered + "</p>");
            $('#answerSection').append("<p> Unanswered: " + unAnswered + "</p>");
            $('#answerSection').append("<br><br> <a id ='resetButton' style='color:red'> Reset </a>");

            $(document).on('click', '#resetButton', function() {

                console.log('second'+intervalId);
                clearInterval(intervalId);
                ClearAllIntervals();
                questionCount = 0;
                correctAnswerPosition = 0;
                correctAnswer;
                time = 30;
                isNewQuestion = true;
                correctlyAnswered = 0;
                unAnswered = 0;
                wronglyAnswered = 0;
                clearbox();
                loadNewQuestion();
            })
        }
    }

    function incrTime() {
        

        time--;
        $('#timerem').text("Time Remaining "+time);
        if (time <= 0) {
            clearInterval(intervalId);
            clearbox();
            $('#question').html("<h2> Out of Time !!! </h2>");
            $('#answerSection').html("<h2> The correct answer was :" + correctAnswer + "</h2>");

            isNewQuestion = true;
            unAnswered++;
            clearInterval(internew);
            setTimeout(loadNewQuestion, 3000);
        }
    }

    $(document).on("click", ".ansbuttons", function(event) {

        if (this.innerText == "Start")
            {
                clearbox();
                loadNewQuestion();
            }
        else {

            if (this.innerText == correctAnswer) {

                clearInterval(intervalId);
                clearbox();
                $('#question').html("<h2> You are correct !!! </h2>");
                $('#answerSection').html("<h2> The correct answer is :" + correctAnswer + "</h2>");
                //insert gif

                correctlyAnswered++
                isNewQuestion = true;
                setTimeout(loadNewQuestion, 3000); 

            } else {
                clearInterval(intervalId);
                clearbox();
                $('#question').html("<h2> You are wrong !!! </h2>");
                $('#answerSection').html("<h2> The correct answer was :" + correctAnswer + "</h2>");
                wronglyAnswered++;
                isNewQuestion = true;
                setTimeout(loadNewQuestion, 3000);
            }

        }

    });

    function clearbox() {
        $('#question').empty();
        $('#answerSection').empty();
    }

    function ClearAllIntervals() {
    for (var i = 1; i < 99999; i++)
        window.clearInterval(i);
}

    /*loadNewQuestion();*/
    </script>
</body>

</html>